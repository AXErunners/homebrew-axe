os: osx
compiler: clang
osx_image: xcode10
cache:
  directories:
    - /usr/local/Homebrew/Library/Homebrew/vendor/bundle

before_install:
  - sudo chown -R "$USER" "$(brew --repo)"
  - travis_retry brew update
  - HOMEBREW_TAP_DIR="$(brew --repo "$TRAVIS_REPO_SLUG")"
  - mkdir -p "$HOMEBREW_TAP_DIR"
  - rm -rf "$HOMEBREW_TAP_DIR"
  - ln -s "$PWD" "$HOMEBREW_TAP_DIR"
  - brew install libyaml

jobs:
  include:
    - stage: test-bot
      script: brew test-bot
    - stage: audit
      script: brew audit --strict ./Formula/*.rb
    - stage: deploy Formula
      script: brew install -v ./Formula/*.rb
    - stage: test Formula
      script: brew test ./Formula/*.rb
    - stage: audit Casks
      script: brew cask audit ./Casks/*.rb
    - stage: deploy Casks
      script: brew cask install -v ./Casks/*.rb
